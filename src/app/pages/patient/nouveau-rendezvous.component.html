<div class="nouveau-rendezvous">
  <!-- Header avec bouton de retour -->
  <div class="header-with-back">
    <div class="header-content">
      <button class="btn-back" (click)="onCancel()" title="Retour au tableau de bord">
        <span class="back-icon">‚Üê</span>
        Retour
      </button>
      <div class="header">
        <h1>Prendre un Rendez-vous</h1>
        <p>Choisissez un docteur et s√©lectionnez une date</p>
      </div>
    </div>
  </div>

  <form [formGroup]="rendezVousForm" (ngSubmit)="onSubmit()" class="rendezvous-form">
    
    <!-- S√©lection du docteur -->
    <div class="form-section">
      <h2>üë®‚Äç‚öïÔ∏è 1. Choisir un Docteur</h2>
      
      <div class="search-box">
        <input 
          type="text" 
          placeholder="Rechercher un docteur par nom, pr√©nom ou sp√©cialit√©..."
          class="search-input"
          (input)="onDocteurSearch($event)"
          aria-label="Rechercher un docteur">
      </div>

      <div class="docteurs-list">
        <div 
          *ngFor="let docteur of filteredDocteurs" 
          class="docteur-option"
          [class.selected]="selectedDocteur?.id === docteur.id"
          (click)="onDocteurSelect(docteur)">
          
          <div class="docteur-avatar">
            <img 
              [src]="getPhotoUrl(docteur.photo)" 
              [alt]="getDocteurDisplayName(docteur)"
              (error)="onPhotoError($event)"
              class="avatar-image">
          </div>
          
          <div class="docteur-details">
            <h3>{{ getDocteurDisplayName(docteur) }}</h3>
            <p class="specialite">{{ docteur.specialite?.titre }}</p>
            <p class="experience">
              <span class="experience-icon">üìÖ</span>
              {{ docteur.anneesExperience || 0 }} ans d'exp√©rience
            </p>
            <div class="rating">
              <span class="stars">‚≠ê {{ docteur.noteMoyenne || '0.0' }}/5</span>
              <span class="reviews">({{ docteur.nombreAvis || 0 }} avis)</span>
            </div>
            <p class="tarif">{{ docteur.tarifConsultation || 'Non sp√©cifi√©' }} ‚Ç¨</p>
            
            <div class="docteur-meta">
              <span class="meta-item" *ngIf="docteur.langue">
                üåê {{ docteur.langue }}
              </span>
              <span class="meta-item" *ngIf="docteur.telephone">
                üìû {{ docteur.telephone }}
              </span>
            </div>
          </div>
          
          <div class="selection-indicator" *ngIf="selectedDocteur?.id === docteur.id">
            ‚úì
          </div>
        </div>

        <div *ngIf="filteredDocteurs.length === 0" class="empty-state">
          <div class="empty-icon">üë®‚Äç‚öïÔ∏è</div>
          <p>Aucun docteur trouv√©</p>
          <small>Essayez de modifier vos crit√®res de recherche</small>
        </div>
      </div>
    </div>

    <!-- S√©lection de la date et heure -->
    <div class="form-section date-time-section" *ngIf="selectedDocteur">
      <h2>üìÖ 2. Choisir la Date et l'Heure</h2>
      
      <div class="selected-docteur-info">
        <div class="selected-docteur-avatar">
          <img 
            [src]="getPhotoUrl(selectedDocteur.photo)" 
            [alt]="getDocteurDisplayName(selectedDocteur)"
            (error)="onPhotoError($event)">
        </div>
        <div class="selected-docteur-details">
          <h4>{{ getDocteurDisplayName(selectedDocteur) }}</h4>
          <p class="specialite">{{ selectedDocteur.specialite?.titre }}</p>
        </div>
      </div>
      
      <div class="date-time-selection">
        <div class="form-group">
          <label for="date">Date du rendez-vous</label>
          <input 
            type="date" 
            id="date"
            formControlName="date"
            class="form-control"
            [min]="getTomorrowDate()"
            [class.is-invalid]="rendezVousForm.get('date')?.invalid && rendezVousForm.get('date')?.touched">
          <div class="invalid-feedback" *ngIf="rendezVousForm.get('date')?.errors?.['required'] && rendezVousForm.get('date')?.touched">
            La date est requise
          </div>
        </div>

        <div class="form-group">
          <label for="heure">Heure du rendez-vous</label>
          <select 
            id="heure"
            formControlName="heure"
            class="form-control"
            [class.is-invalid]="rendezVousForm.get('heure')?.invalid && rendezVousForm.get('heure')?.touched">
            <option value="">S√©lectionnez une heure</option>
            <option *ngFor="let slot of availableSlots" [value]="slot">
              {{ slot }}
            </option>
          </select>
          <div class="invalid-feedback" *ngIf="rendezVousForm.get('heure')?.errors?.['required'] && rendezVousForm.get('heure')?.touched">
            L'heure est requise
          </div>
        </div>
      </div>

      <!-- Message d'erreur disponibilit√© -->
      <div *ngIf="disponibiliteError" class="alert alert-error">
        <div class="error-icon">‚ö†Ô∏è</div>
        <div class="error-content">
          <h4>Cr√©neau non disponible</h4>
          <p>{{ disponibiliteError }}</p>
          
          <div *ngIf="creneauxSuggerees.length > 0" class="suggested-slots">
            <h5>Cr√©neaux disponibles sugg√©r√©s :</h5>
            <div class="suggested-buttons">
              <button 
                *ngFor="let creneau of creneauxSuggerees" 
                type="button"
                class="btn btn-outline btn-sm"
                (click)="utiliserCreneauSuggere(creneau)">
                {{ creneau }}
              </button>
            </div>
          </div>
        </div>
      </div>

      <div *ngIf="availableSlots.length > 0" class="available-slots-info">
        <p class="slots-count">{{ availableSlots.length }} cr√©neau(x) disponible(s) pour cette date</p>
      </div>
    </div>

    <!-- Motif de la consultation -->
    <div class="form-section" *ngIf="selectedDocteur">
      <h2>üìù 3. Motif de la Consultation</h2>
      
      <div class="form-group">
        <label for="motif">D√©crivez bri√®vement le motif de votre consultation</label>
        <textarea 
          id="motif"
          formControlName="motif"
          class="form-control"
          rows="4"
          placeholder="Ex: Consultation de routine, douleurs particuli√®res, suivi de traitement, examen annuel..."
          [class.is-invalid]="rendezVousForm.get('motif')?.invalid && rendezVousForm.get('motif')?.touched">
        </textarea>
        <div class="invalid-feedback" *ngIf="rendezVousForm.get('motif')?.errors?.['required'] && rendezVousForm.get('motif')?.touched">
          Le motif est requis
        </div>
        <div class="invalid-feedback" *ngIf="rendezVousForm.get('motif')?.errors?.['minlength'] && rendezVousForm.get('motif')?.touched">
          Minimum 10 caract√®res (actuellement: {{ rendezVousForm.get('motif')?.value?.length || 0 }})
        </div>
        <div class="char-count">
          {{ rendezVousForm.get('motif')?.value?.length || 0 }}/10 caract√®res minimum
        </div>
      </div>
    </div>

    <!-- R√©capitulatif -->
    <div class="form-section recap-section" *ngIf="selectedDocteur && isFormReady()">
      <h2>‚úÖ 4. R√©capitulatif</h2>
      
      <div class="recap-content">
        <div class="recap-item">
          <strong>Docteur:</strong>
          <span>{{ getDocteurDisplayName(selectedDocteur) }} - {{ selectedDocteur.specialite?.titre }}</span>
        </div>
        <div class="recap-item">
          <strong>Date:</strong>
          <span>{{ rendezVousForm.get('date')?.value | date:'fullDate':'':'fr' }}</span>
        </div>
        <div class="recap-item">
          <strong>Heure:</strong>
          <span>{{ rendezVousForm.get('heure')?.value }}</span>
        </div>
        <div class="recap-item">
          <strong>Motif:</strong>
          <span class="motif-text">{{ rendezVousForm.get('motif')?.value }}</span>
        </div>
      </div>
    </div>

    <!-- Actions -->
    <div class="form-actions">
      <button type="button" class="btn btn-secondary" (click)="onCancel()">
        <span class="btn-icon">‚Üê</span>
        Annuler
      </button>
      
      <button 
        type="submit" 
        class="btn btn-primary"
        [disabled]="!isFormReady() || isLoading"
        [class.loading]="isLoading">
        <span *ngIf="!isLoading" class="btn-content">
          <span class="btn-icon">‚úÖ</span>
          Confirmer le Rendez-vous
        </span>
        <span *ngIf="isLoading" class="btn-content">
          <span class="spinner"></span>
          Cr√©ation en cours...
        </span>
      </button>
    </div>

    <!-- Indicateur de progression -->
    <div class="progress-indicator" *ngIf="selectedDocteur">
      <div class="progress-steps">
        <div class="step completed">
          <div class="step-number">1</div>
          <span class="step-label">Docteur</span>
        </div>
        <div class="step completed">
          <div class="step-number">2</div>
          <span class="step-label">Date/Heure</span>
        </div>
        <div class="step" [class.completed]="rendezVousForm.get('motif')?.valid">
          <div class="step-number">3</div>
          <span class="step-label">Motif</span>
        </div>
        <div class="step" [class.completed]="isFormReady()">
          <div class="step-number">4</div>
          <span class="step-label">Confirmation</span>
        </div>
      </div>
    </div>
  </form>
</div>